2025-09-22 19:04:49,249 [INFO] Starting compression for file: D:\Files\Projects\AutoCompression\Tests\DoVi.mkv
2025-09-22 19:04:49,249 [DEBUG] Compression parameters - Profile: ['-function', 'ffmpeg'], Target resolution: 1920, CQ: 30, Crop: [10, 10]
2025-09-22 19:04:49,249 [DEBUG] Performing temporal crop to: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:49,249 [INFO] Starting temporal crop: D:\Files\Projects\AutoCompression\Tests\DoVi.mkv -> D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:49,250 [DEBUG] Crop parameters - Start: 2s, Duration: 5s
2025-09-22 19:04:49,250 [DEBUG] ffmpeg command for temporal crop: ['ffmpeg', '-y', '-ss', '2', '-i', 'D:\\Files\\Projects\\AutoCompression\\Tests\\DoVi.mkv', '-t', '5', '-c:v', 'copy', '-c:a', 'copy', '-copy_unknown', 'D:\\Files\\Projects\\AutoCompression\\Tests\\workspaces\\DoVi_H265\\H265_DoVi_time_crop.mkv']
2025-09-22 19:04:49,934 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:49,934 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:49,934 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv (Size: 70253040 bytes)
2025-09-22 19:04:49,934 [INFO] Using compression function: ffmpeg
2025-09-22 19:04:49,935 [INFO] Starting FFmpeg encoding workflow: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:49,935 [INFO] HDR processing enabled - starting metadata workflow
2025-09-22 19:04:49,935 [INFO] Starting HDR metadata type detection for: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:49,935 [DEBUG] Output paths - DoVi: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\dovi_metadata_test.bin, HDR10+: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\HDR10_metadata_test.json
2025-09-22 19:04:49,935 [DEBUG] Metadata type not cached, performing detection
2025-09-22 19:04:49,935 [INFO] Attempting Dolby Vision metadata extraction
2025-09-22 19:04:49,936 [DEBUG] Using DoVi tool path: tools\dovi_tool.exe
2025-09-22 19:04:49,936 [DEBUG] DoVi extraction command: tools\dovi_tool.exe extract-rpu -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv -o D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\dovi_metadata_test.bin
2025-09-22 19:04:50,005 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:50,005 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\dovi_metadata_test.bin
2025-09-22 19:04:50,005 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\dovi_metadata_test.bin (Size: 27594 bytes)
2025-09-22 19:04:50,005 [INFO] DoVI metadata file is valid
2025-09-22 19:04:50,006 [INFO] Getting framerate
2025-09-22 19:04:50,006 [DEBUG] Complete FFmpeg command: ffprobe -v error -select_streams v:0 -show_entries stream=r_frame_rate -of default=noprint_wrappers=1:nokey=1 D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:54,096 [DEBUG] Probe r_frame_rate: 24000/1001
2025-09-22 19:04:54,096 [DEBUG] Probe r_frame_rate: 23.976
2025-09-22 19:04:54,096 [INFO] Starting HDR metadata extraction for: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv
2025-09-22 19:04:54,097 [DEBUG] Metadata type: DoVi
2025-09-22 19:04:54,097 [DEBUG] Output paths - DoVi: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin, HDR10+: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoViHDR10_metadata.json
2025-09-22 19:04:54,097 [INFO] Extracting Dolby Vision RPU metadata
2025-09-22 19:04:54,097 [DEBUG] Using DoVi tool path: tools\dovi_tool.exe
2025-09-22 19:04:54,097 [DEBUG] DoVi extraction command: tools\dovi_tool.exe extract-rpu -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv -o D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin
2025-09-22 19:04:54,136 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:54,136 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin
2025-09-22 19:04:54,136 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin (Size: 27594 bytes)
2025-09-22 19:04:54,136 [INFO] Starting FFmpeg video encoding: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv -> D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc
2025-09-22 19:04:54,137 [DEBUG] Encoding parameters - Target resolution: 1920, CQ: 30, Crop: [10, 10]
2025-09-22 19:04:54,318 [DEBUG] Complete FFmpeg command: ffmpeg -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_time_crop.mkv -an -sn -c:v hevc_nvenc -preset slow -tune uhq -g 120 -bf 4 -refs 4 -spatial-aq 1 -temporal-aq 1 -aq-strength 8 -pix_fmt p010le -b:v 0 -rc-lookahead 50 -vf hqdn3d,crop=3840:2140:0:10,scale=1920:-2:sws_flags=neighbor -copy_unknown -map_metadata 0 -cq 30 -y D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc
2025-09-22 19:04:54,318 [INFO] Starting FFmpeg encoding process
2025-09-22 19:04:58,614 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:58,614 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc
2025-09-22 19:04:58,614 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc (Size: 1552540 bytes)
2025-09-22 19:04:58,614 [INFO] Starting HDR metadata injection for: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc
2025-09-22 19:04:58,614 [INFO] Injecting D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin metadata into D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_HDR_inject.hevc
2025-09-22 19:04:58,615 [DEBUG] Metadata type: DoVi
2025-09-22 19:04:58,615 [DEBUG] Tools path: tools
2025-09-22 19:04:58,615 [INFO] Injecting Dolby Vision RPU metadata
2025-09-22 19:04:58,615 [DEBUG] Using DoVi tool path: tools\dovi_tool.exe
2025-09-22 19:04:58,615 [DEBUG] DoVi injection command: tools\dovi_tool.exe inject-rpu -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_reencode.hevc --rpu-in D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVidovi_metadata.bin -o D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_HDR_inject.hevc
2025-09-22 19:04:58,644 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:58,644 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_HDR_inject.hevc
2025-09-22 19:04:58,645 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_HDR_inject.hevc (Size: 1582042 bytes)
2025-09-22 19:04:58,645 [INFO] Converting .hevc to .mkv
2025-09-22 19:04:58,645 [DEBUG] Complete FFmpeg command: ffmpeg -y -fflags +genpts -r 23.976 -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi_HDR_inject.hevc -c:v copy -movflags frag_keyframe+empty_moov D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mp4
2025-09-22 19:04:59,244 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:59,244 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mp4
2025-09-22 19:04:59,245 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mp4 (Size: 1584332 bytes)
2025-09-22 19:04:59,245 [INFO] 1st step success
2025-09-22 19:04:59,245 [DEBUG] Complete FFmpeg command: ffmpeg -y -i D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mp4 -c:v copy D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mkv
2025-09-22 19:04:59,339 [DEBUG] Command execution finished succesfully
2025-09-22 19:04:59,339 [DEBUG] Validating output file: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mkv
2025-09-22 19:04:59,339 [DEBUG] File check passed: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi.mkv (Size: 1583998 bytes)
2025-09-22 19:04:59,339 [INFO] 2nd step success
2025-09-22 19:04:59,340 [INFO] FFmpeg encoding workflow completed successfully: D:\Files\Projects\AutoCompression\Tests\workspaces\DoVi_H265\H265_DoVi
2025-09-22 19:04:59,340 [INFO] Compression completed successfully for: H265_DoVi
